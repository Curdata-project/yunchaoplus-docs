# 1. 认证与环境

在调用 API 时，必须提供 API Key 作为每个请求的身份验证。你可以在管理平台内管理你的 API Key。API Key 是商户在云钞PLUS系统中的身份标识，请安全存储，确保其不要被泄露。如需获取或更新 API Key，请联系您的客户经理。

云钞PLUS提供了生产与测试两套环境，其中两套环境使用不同的API KEY，以及不同的URL端点接口，后文使用`$endpoint`代指对应环境的端口：

- 生产环境：`https://p-api.yunchaoplus.com/api/v1`
- 测试环境：`https://t-api.yunchaoplus.com/api/v1`

### HTTP头认证

平台使用 HTTP 头作为基础，需要将API KEY作为头 `X-API-KEY` 传递至后端。

### 数字签名与加密

为了保证数据传输的安全性以及不可篡改性，API传输的数据需要通过公私钥证书进行认证。具体流程如下：

 **数据结构体:**
```
{
    "version": 2,          结构体版本
    "payload": String,     负载内容
    "nonce": String        Xsalsa20 nonce
}
```

1. 商户登录控制台操作生成自己的公私钥并获取最新的平台公钥，请注意妥善保管密钥文件!
2. 商户加载对应语言的`NaCl`库至开发环境中（符合`Curve25519Xsalsa20Poly1305`算法）。
3. 商户服务器将商户私钥、平台公钥、生成的随机`nonce`及准备好发送的消息体（若GET不存在消息体，则需要生成一个长度为16字节的随机数作为消息体） 传入对应语言`NaCl`库的`Public-key cryptography box`函数得到带签名的密文数据。
4. 商户服务器对密文数据和`nonce`做BASE64编码，按照规范组成数据结构体作为请求体。
5. 商户服务器将请求体携带着`X-API-KEY`请求头发送给本平台。

同样的，消息返回体也会遵循上述流程进行操作。
对返回的数据,商户同样需要通过公私钥进行解密校验，具体流程如下：
1. 商户服务器收到返回的数据，将结构体中的密文数据及`nonce`取出。
2. 商户服务器对密文数据和`nonce`做BASE64解码。
3. 商户服务器将商户私钥、平台公钥、`nonce`及密文数据 传入对应语言`NaCl`库的`Public-key cryptography box_open`函数得到明文数据即接口返回的消息体。
