# 1. 认证与环境

在调用 API 时，必须提供 API Key 作为每个请求的身份验证。你可以在管理平台内管理你的 API Key。API Key 是商户在云钞PLUS系统中的身份标识，请安全存储，确保其不要被泄露。如需获取或更新 API Key，请联系您的客户经理。

云钞PLUS提供了生产与测试两套环境，其中两套环境使用不同的API KEY，以及不同的URL端点接口，后文使用`$endpoint`代指对应环境的端口：

- 生产环境：`https://p-api.yunchaoplus.com/api/v1`
- 测试环境：`https://t-api.yunchaoplus.com/api/v1`

### HTTP头认证

平台使用 HTTP 头作为基础，需要将API KEY作为头 `X-API-KEY` 传递至后端。

### 数字签名与加密

为了保证数据传输的安全性以及不可篡改性，API传输的数据需要通过公私钥证书进行认证。具体流程如下：

> 补充一些数据结构

1. 商户使用命令工具集 `crypro-utils` 生成对应的商户公私钥文件。
2. 商户联系客户经理，将生成的商户公钥文件提交给客户经理，并从客户经理处获取最新的平台公钥。
3. 商户下载对应语言的SDK，并将其加载至开发环境中。
4. 商户服务器生成临时公钥与临时私钥。
5. 商户服务器利用临时私钥与平台公钥生成对称密钥。
6. 商户服务器准备好发送的消息体（若GET不存在消息体，则需要生成一个长度为16字节的随机数作为消息体），利用对称密钥进行加密，并对加密后的结果进行BASE64编码。
7. 商户服务器将临时用公钥使用BASE64编码，与BASE64编码后的加密消息体进行连接。
8. 商户服务器将连接结果使用商户私钥进行数字签名，将最后数字签名的内容与请求体发送给本平台。

如果用户觉得如上流程实现难度较大，可以使用本平台提供的SDK进行开发，[SDK下载](#)。

示例代码如下：

- Python
- Rust
- Java
- Go